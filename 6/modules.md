# 6. ماژول‌ها

اگر از مفسر پایتون خارج شده و دوباره وارد شوید، تمام تعاریفی که ساخته‌اید (شامل توابع و متغیرها) از بین خواهند رفت. بنابراین اگر قصد نوشتن برنامه‌ای طولانی‌تر دارید، بهتر است از یک ویرایشگر متن برای تهیه ورودی مفسر استفاده کنید و سپس فایل ورودی را اجرا کنید. این فرآیند به عنوان ایجاد یک اسکریپت شناخته می‌شود. هر چه برنامه طولانی‌تر شود، ممکن است بخواهید آن را به چندین فایل تقسیم کنید تا نگهداری آن آسان‌تر شود. همچنین ممکن است بخواهید از یک تابع مفید در چند برنامه مختلف بدون نیاز به کپی کردن تعریف آن استفاده کنید.

برای پشتیبانی از این موضوع، پایتون روشی دارد که تعاریف را در یک فایل ذخیره کرده و در یک اسکریپت یا یک نمونه تعاملی از مفسر استفاده می‌کند. این فایل به عنوان یک ماژول شناخته می‌شود؛ تعاریف موجود در یک ماژول می‌توانند به ماژول‌های دیگر یا به ماژول اصلی (مجموعه متغیرهایی که در سطح بالای یک اسکریپت و در حالت ماشین‌حساب اجرا می‌شوند) وارد شوند.

یک ماژول، فایلی است که شامل تعاریف و دستورات پایتون است. نام فایل همان نام ماژول با پسوند `.py` است. داخل یک ماژول، نام ماژول به عنوان یک رشته به عنوان مقدار متغیر سراسری `__name__` در دسترس است. مثلاً می‌توانید با استفاده از ویرایشگر متن دلخواه خود یک فایل به نام `fibo.py` در پوشه جاری ایجاد کنید و محتوای زیر را در آن قرار دهید:

```python
# Fibonacci numbers module

def fib(n):    # write Fibonacci series up to n
    a, b = 0, 1
    while a < n:
        print(a, end=' ')
        a, b = b, a+b
    print()

def fib2(n):   # return Fibonacci series up to n
    result = []
    a, b = 0, 1
    while a < n:
        result.append(a)
        a, b = b, a+b
    return result
```

حالا وارد مفسر پایتون شوید و این ماژول را با دستور زیر وارد کنید:

```python
>>> import fibo
```

این دستور نام توابع تعریف‌شده در `fibo` را مستقیماً به فضای نام فعلی اضافه نمی‌کند؛ بلکه فقط نام ماژول `fibo` را به آنجا اضافه می‌کند. با استفاده از نام ماژول می‌توانید به توابع دسترسی پیدا کنید:

```python
>>> fibo.fib(1000)
0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987
>>> fibo.fib2(100)
[0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]
>>> fibo.__name__
'fibo'
```

اگر می‌خواهید یک تابع را مکرراً استفاده کنید، می‌توانید آن را به یک نام محلی اختصاص دهید:

```python
>>> fib = fibo.fib
>>> fib(500)
0 1 1 2 3 5 8 13 21 34 55 89 144 233 377
```

## 6.1. اطلاعات بیشتر در مورد ماژول‌ها 

یک ماژول می‌تواند شامل دستورات اجرایی و همچنین تعریف توابع باشد. این دستورات برای مقداردهی اولیه ماژول در نظر گرفته شده‌اند. این دستورات تنها اولین باری که نام ماژول در یک عبارت واردات ([import](https://docs.python.org/3/reference/simple_stmts.html#import)) با آن برخورد می‌کند، اجرا می‌شوند. [^1] (این دستورات همچنین در صورتی که فایل به عنوان یک اسکریپت اجرا شود، نیز اجرا می‌شوند.)

هر ماژول فضای نام خصوصی خودش را دارد که به عنوان فضای نام سراسری توسط تمام توابع تعریف شده در ماژول استفاده می‌شود. بنابراین، نویسنده یک ماژول می‌تواند از متغیرهای سراسری در ماژول استفاده کند بدون اینکه نگران تداخل تصادفی با متغیرهای سراسری کاربر باشد. از سوی دیگر، اگر بدانید چه می‌کنید، می‌توانید به متغیرهای سراسری یک ماژول با همان نشانه‌گذاری که برای اشاره به توابع آن استفاده می‌شود، دسترسی پیدا کنید: `modname.itemname`.

ماژول‌ها می‌توانند ماژول‌های دیگری را وارد کنند. به طور معمول، اما نه لزوماً، همه دستورات واردات ([import](https://docs.python.org/3/reference/simple_stmts.html#import)) در ابتدای یک ماژول (یا اسکریپت) قرار می‌گیرند. نام ماژول‌های وارد شده، اگر در سطح بالای یک ماژول (خارج از هر تابع یا کلاسی) قرار گیرند، به فضای نام سراسری ماژول اضافه می‌شوند.

یک نوع از عبارت واردات وجود دارد که نام‌ها را مستقیماً از یک ماژول به فضای نام ماژول واردکننده وارد می‌کند. برای مثال:

``` python
>>> from fibo import fib, fib2
>>> fib(500)
0 1 1 2 3 5 8 13 21 34 55 89 144 233 377
```

این روش نام ماژولی که واردات از آن انجام می‌شود را به فضای نام محلی معرفی نمی‌کند (بنابراین، در مثال، نام `fibo` تعریف نشده است).

حتی یک نوع دیگر نیز وجود دارد که تمام نام‌هایی را که یک ماژول تعریف می‌کند، وارد می‌کند:

``` python
>>> from fibo import *
>>> fib(500)
0 1 1 2 3 5 8 13 21 34 55 89 144 233 377
```

این دستور همه نام‌ها به‌جز آن‌هایی که با زیرخط (`_`) شروع می‌شوند را وارد می‌کند. در بیشتر موارد، برنامه‌نویسان پایتون از این قابلیت استفاده نمی‌کنند، زیرا مجموعه‌ای نامشخص از نام‌ها را وارد محیط مفسر می‌کند که ممکن است برخی از چیزهایی که قبلاً تعریف کرده‌اید را پنهان کند.

توجه داشته باشید که به طور کلی استفاده از `*` برای وارد کردن از یک ماژول یا بسته توصیه نمی‌شود، زیرا اغلب منجر به کدهایی می‌شود که خوانایی کمی دارند. با این حال، در جلسات تعاملی برای صرفه‌جویی در تایپ، استفاده از آن بلامانع است.

اگر پس از نام ماژول از `as` استفاده شود، نامی که پس از `as` می‌آید مستقیماً به ماژول وارد شده ارجاع داده می‌شود.

``` python
>>> import fibo as fib
>>> fib.fib(500)
0 1 1 2 3 5 8 13 21 34 55 89 144 233 377
```

این روش به‌طور مؤثری ماژول را به همان شیوه‌ای وارد می‌کند که `import fibo` انجام می‌دهد، با این تفاوت که اکنون با نام `fib` در دسترس است.

این روش را می‌توان هنگام استفاده از `from` نیز به‌کار برد و اثرات مشابهی خواهد داشت:

``` python
>>> from fibo import fib as fibonacci
>>> fibonacci(500)
0 1 1 2 3 5 8 13 21 34 55 89 144 233 377
```

### 6.1.1. اجرای ماژول‌ها به‌عنوان اسکریپت

هنگامی که یک ماژول پایتون را با اجرا کنید :

``` bash
python fibo.py <arguments>
```

کد موجود در ماژول اجرا خواهد شد، درست مانند زمانی که آن را وارد (import) می‌کنید، اما با این تفاوت که مقدار `__name__` برابر با `"__main__"` تنظیم می‌شود. این بدان معناست که با افزودن این کد در انتهای ماژول خود:

``` python
if __name__ == "__main__":
    import sys
    fib(int(sys.argv[1]))
```

می‌توانید فایل را هم به‌عنوان یک اسکریپت و هم به‌عنوان یک ماژول واردشدنی قابل استفاده کنید، زیرا کدی که فرمان‌های خط فرمان را تجزیه می‌کند، تنها زمانی اجرا می‌شود که ماژول به‌عنوان فایل «اصلی» اجرا شود.

``` python
>>> python fibo.py 50
0 1 1 2 3 5 8 13 21 34
```

اگر ماژول وارد شده باشد، کد اجرا نمی شود:

``` python
>>> import fibo
>>>
```

این معمولاً برای ارائه یک رابط کاربری مناسب برای یک ماژول یا برای اهداف آزمایشی استفاده می‌شود (اجرای ماژول به‌عنوان یک اسکریپت، یک مجموعه تست را اجرا می‌کند).

https://docs.python.org/3/tutorial/modules.html#the-module-search-path
